- 目标平台
  - rst信号为高电平复位一段时间，然后拉低。
  - 在经过非门转换后，即先为低电平，然后拉高
  - 目标芯片Spartan®-3类型XC3S400AN-FTG256AGQ1821D5629176A芯片
- 本地平台
  - sys_rst_n:先为高电平，然后下降为低电平，随后恢复为高电平：即复位时产生一个向下周期

| uart_rx | 类型 |低电平 | 高电平 | 上升沿 | 下降沿 |
| --- | --- | --- | --- | --- | --- |
| sys_rst_n | 低电平下降沿复位 | 复位 | | | 复位 |
| po_flag |

| SDWriterInit | 类型 |低电平 | 高电平 | 上升沿 | 下降沿 |
| --- | --- | --- | --- | --- | --- |
| sys_rst_n | 低电平下降沿复位 | 复位 | | | 复位 |
| cs_n | 输出片选 | 低电平有效（选中） |

## FIFO模块

FIFO使得以912600频率的串口数据得以缓冲，构建512字节一个扇区的内容，以此允许数据写入。

| FIFO | 类型 |低电平 | 高电平 | 上升沿 | 下降沿 |
| --- | --- | --- | --- | --- | --- |
| rst | 高电平下降沿复位 |  | 复位 | |  |
| ~sys_rst_n | 实际输入时钟，低电平复位 |  复位 | | |  |

FIFO rst平时处于低电平状态

## 可能存在的BUG：

- 存在强制保存时间，如果超过一定时间没有写入数据，会强制保存。此时会将未凑够的512字节中，最后一个符号填充。
  - 例：最后存在12345，那么保存后则为123455555555555555555555555(凑够512个)，即最后一个符号5重复填充了
- 波特率错误会导致写入数据错误。目前测试是在直接给予低电平，不触发复位的情况下，以14400波特率向921600写入，会产生写入数据0的效果
- SD卡不能随意插拔，一旦拔出SD卡，则无法处理FIFO的输出请求，系统卡死，即便重新插入SD卡也不能再读取数据。与此同时，也不再写入数据。
  - 未验证：如果此时给SD卡复位信号或许可以继续使用，但是按照代码逻辑，写入地址也将复位
- 针对于部署平台验证猜测：
  - 在部署平台上运行，FIFO在不断的主动输出0xFF
  - 若将FIFO强制使能读，FIFO输出的为00，并且事实上并没有触发SD卡写入
  - 如果错误来源于初始化，不影响FIFO正常工作。事实上，是否有执行初始化并不影响SD卡操作，只要初始化信号为1不截胡数据即可
  - 即便强制初始化完成，数据依然可以写入。但是一旦拔掉SD卡，即便再插入SD卡，系统仍然不工作。
  - ## 怀疑：是否是SD卡管脚实际上有问题，例如不能输入或者不能输出，使得SD卡模块触发了某种机制
  - 若为MISO管脚错误，则无法得知SD卡状态，表现为没有连接SD卡，FIFO无输出，不符合。MOSI同理。
  - 若为FIFO的对比数据被错误的优化掉了，则会导致FIFO主动输出数据，且不会向SD卡写入数据。该项可能性最大

## 特性：

- 当一段时间未发送数据（理论估计:$\frac{60 000}{20 000 000}=3ms$），会强制保存数据
- 复位信号不影响接收串口数据，即，给与复位信号时，SD卡不会写入数据。取消复位信号，即工作。换而言之：
  - 当模块设计为高电平复位（sys_rst接口），
    - 若给予其高电平，则系统始终复位，不工作
    - 若给与其低电平，则系统工作
    - 不需要需要给予其一个上升沿，并且恢复至低电平的复位信号；
  - 当复位模块设计为低电平复位（sys_rst_n），
    - 若给予其低电平，则系统始终复位，不工作
    - 若给与琦高电平，则系统始终工作
    - 不需要给与其一个下降沿，并且恢复至高电平的复位信号；
  - 即复位信号是非必要的。即便没有也能正常工作。
- 时钟取反不影响工作

## SDIO与SPI

SPI工作模式下，使用引脚：

| 网络名称 | 输入/输出 | 引脚 | 含义
| --- | --- | --- | --- |
|sd_clk|	output|	A16	|SD卡的时钟信号 |
|sd_cs|	output	|A14 	|SD卡的片选信号 |
|sd_miso|	input	|B17	|SD卡的数据发送管脚 |
|sd_mosi|	output|	A15|	SD卡的数据接收管脚
|sd_cd|	input	|A18|	SD卡插拔检测 |

SDIO工作模式下，使用引脚：

| 网络名称 | 输入/输出 | 引脚 | 含义
| --- | --- | --- | --- |
|sd_clk|	output|	A16	|SD卡的时钟信号
|sd_cmd|	inout	|A15 	|SD卡的命令引脚
|sd_data0|	inout	|B17	|SD卡的数据
|sd_data1|	inout|	B18|	SD卡的数据
|sd_data2|	inout	|A13|	SD卡的数据
|sd_data2|	inout	|A14|	SD卡的数据
